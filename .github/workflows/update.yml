name: Daily Article Filter
on:
  schedule:
    # 05:00 UTC is 11:00 AM Bangladesh Standard Time
    - cron: '0 5 * * *'
  workflow_dispatch: # Allows manual trigger

jobs:
  filter-and-update:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Cache Transformer Model
        uses: actions/cache@v3
        with:
          path: ~/.cache/torch/sentence_transformers
          key: sentence-transformers-all-mpnet-base-v2-${{ runner.os }}
          restore-keys: |
            sentence-transformers-all-mpnet-base-v2-

      - name: Install Libraries
        run: pip install -r requirements.txt

      - name: Run Multi-API Filter
        env:
          GEM: ${{ secrets.GEM }}
          OP: ${{ secrets.OP }}
          FRY: ${{ secrets.FRY }}
          GEM2: ${{ secrets.GEM2 }}
        run: python main.py

      - name: Push Filtered XML
        run: |
          git config --global user.name "Automated-Filter"
          git config --global user.email "actions@github.com"
          git add *.xml
          git commit -m "Daily filtered update: $(date)" || exit 0
          git push origin main